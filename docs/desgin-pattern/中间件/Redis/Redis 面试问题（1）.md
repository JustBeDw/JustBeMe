## Redis 面试问题（1）

#### 在集群模式下，Redis 的 Key 是如何寻址的？分布式寻址都有哪些算法？了解一致性 Hash 算法吗？

hash算法 

一致性hash算

slot hash算法

#### 使用Redis有哪些好处？

减轻数据库的压力，速度更快，因为是内存操作；支持集群部署和主从模式，保证服务高可用；支持多种数据格式。

#### Redis相比Memcached有哪些优势？

**Redis：**单线程的 IO多路复用，可以数据持久化，有事务；  
**Memcached：**多线程，所以有上下文切换，不能数据持久化，没有事务；

#### Redis常见性能问题和解决方案

1. Master写内存快照，save命令调度rdbSave函数，会阻塞主线程的工作，当快照比较大时对性能影响是非常大的，会间断性暂停服务，所以Master最好不要写内存快照。`（Master不要做持久化工作）`
2. Master AOF持久化，如果不重写AOF文件，这个持久化方式对性能的影响是最小的，但是AOF文件会不断增大，AOF文件过大会影响Master重启的恢复速度。`（如果数据比较关键，某个Slave开启AOF备份数据，策略为每秒同步一次）`
3. 为了主从复制的速度和连接的稳定性，Slave和Master最好在同一个局域网内。
4. 尽量避免在压力较大的主库上增加从库。
5. 为了Master的稳定性，主从复制不要用图状结构，用单向链表结构更稳定，即主从关系为：Master<--Slave1<--Slave2<--Slave3.......，这样的结构也方便解决单点故障问题，实现Slave对Master的替换，也即，如果Master挂了，可以立马启用Slave1做Master，其他不变。

#### MySQL里有2000w数据，Redis中只存20w的数据，如何保证Redis中的数据都是热点数据？

Redis内存数据集大小上升到一定大小的时候，就会施行数据淘汰策略。

Redis提供6种数据淘汰策略：

volatile-lru：从已设置过期时间的数据集（server.db[i].expires）中挑选最近最少使用的数据淘汰

volatile-ttl：从已设置过期时间的数据集（server.db[i].expires）中挑选将要过期的数据淘汰

volatile-random：从已设置过期时间的数据集（server.db[i].expires）中任意选择数据淘汰

allkeys-lru：从数据集（server.db[i].dict）中挑选最近最少使用的数据淘汰

allkeys-random：从数据集（server.db[i].dict）中任意选择数据淘汰

no-enviction（驱逐）：禁止驱逐数据

#### Memcache与Redis的区别都有哪些？

M只有简单字符串，而R有多种数据类型；

R支持事务；R可以持久化数据；

#### 在什么样的场景下可以充分的利用Redis的特性，大大提高Redis的效率？

1. **String：**可以将数据存成字符串，然后反序列化得到对象。
2. **List：**因为是有序的所以，可以做异步队列；不过更多的是做评论，关注。
3. **Hash：**....
4. **set：**无序集合，交集并集差集；可以做共同关注人。
5. **zset：**有序集合，微博排行榜。

#### Redis的缓存雪崩、穿透、击穿了解么？有什么异同点？分别怎么解决？

1. **雪崩：**同一时间大量Key失效，大量请求直接达到db层，给失效时间加一个随机值，避免同一时间同时失效。
2. **穿透：**只请求不存在的数据，导致直接查询db层，查询空数据也进行缓存，使用布隆过滤器过滤非法请求。
3. **击穿：**针对一个Key，发送大量请求，等Key失效，请求全部打到db层，不设置过期时间。

#### Redis的基本类型有哪些？他们的使用场景了解么？比较高级的用法你使用过么？

1. **String：**可以将数据存成字符串，然后反序列化得到对象。

2. **List：**因为是有序的所以，可以做异步队列；不过更多的是做评论，关注。

3. **Hash：**....

4. **set：**无序集合，交集并集差集；可以做共同关注人。

5. **zset：**有序集合，微博排行榜。

   **高级用法：**bitmap hypedloglog bloomfilter

#### Redis主从怎么同步数据的？集群的高可用怎么保证？持久化机制了解么？

slave启动后，想master发送psync 命令，master将rdb数据传输给slave，并用aof同时发送给salve；

哨兵模式保证高可用，一般至少使用三个节点，保证master 挂了两个节点能选举出新的节点作为master

RDB fork子进程进行持久化操作，但是会失去最后一次持久化数据；AOF对日志追加数据。

#### 为什么 redis 单线程却能支撑高并发？

redis使用file event handle 文件处理器 ，这个文件处理器是单线程

file event handle（PS 与nio 类似架构）

1. 多socket
2. IO多路复用程序
3. 文件时间分派器
4. 事件处理器（连接应答，命令请求，命令回复 ）

性能高的原因

纯内纯操作，存取效率高

非阻塞的io多路复用

使用C语言开发，相对编译效率高

使用单线程，避免频繁上下文切换

#### 如何保证缓存和数据库数据的一致性？

1 一般允许缓存在与数据差异

2缓存策略，如果缓存中无数据，查询数据并存入缓存

如果数据修改，删除缓存

#### 项目中是怎么用缓存的，用了缓存之后会带来什么问题？

#### 使用过Redis分布式锁么，它是什么回事？

先拿setnx来争抢锁，抢到之后，再用expire给锁加一个过期时间防止锁忘记了释放。  
如果在setnx之后，expire之前宕机了；可以使用setex，setex是setnx + expire 的结合。